<!DOCTYPE html>
<html>
    <head>
        <title>Tabler demos</title>
        <link href="css/bootstrap.css" type="text/css" rel="stylesheet" />

        <script src="jquery-1.7.1.js"></script>
        <script src="underscore.js"></script>
        <script src="../lib/tabler/tabler.js"></script>
        <script src="../lib/tabler/tabler.pager.js"></script>
        <script src="../lib/tabler/tabler.infiniTable.js"></script>

        <script>
            // Use your own key!
            RT_API_KEY = 'uht2fj2a3erk5tgkn6cm3m38';
        </script>
        <style>
        .scroll{
            overflow-y:scroll;
            height:300px;
        }
        .thumbnail{
            height:91px;
        }
        </style>
    </head>
    <body>
        <div class="container">
            <h1>Tabler demos</h1>

            <div id="infini-table">
                <h2>Table with infinite scroll <a href="#infini-table" class="icon-tag"></a></h2>
                <div id="infiniTable"></div>

                <script>
                    var infiniTable = tabler.create([
                            {field:'title', name: 'Name'},
                            {field:'year', name: 'Year'},
                            {field:'posters', name: 'Poster', formatter: function(data){
                                return '<img src="' + data.thumbnail + '" class="thumbnail" />';
                            }}
                        ], {
                            className: 'table',
                            plugins: [tabler.pager, tabler.infiniTable],
                            pager: {
                                pageSize: 5
                            },
                            fetch: function(options, done){
                                $.ajax({
                                    url: 'http://api.rottentomatoes.com/api/public/v1.0/movies.json',
                                    dataType: 'jsonp',
                                    data: {
                                        apikey: RT_API_KEY,
                                        q: 'Die Hard',
                                        page_limit: 5,
                                        page: options.currentPage + 1
                                    }
                                }).success(function(data){
                                    done({
                                        totalResults: data.total,
                                        pageSize: options.pageSize,
                                        items: data.movies
                                    });
                                });
                            }
                        });

                    infiniTable.render();

                    $('#infiniTable').html(infiniTable.$el);
                </script>
            </div>
        </div>

        <script>
            $('.container script').each(function(i, el){
                var script = $(el);

                script.before('<pre>\n' + _.escape(script.text().replace(/^[ ]{20}/gm, '')).trim() + '\n</pre>');
            });
        </script>

    </body>
</html>